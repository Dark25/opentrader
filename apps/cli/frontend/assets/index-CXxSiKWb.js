import{a$ as d,aZ as K}from"./index-DacOZnWA.js";import{z as m}from"./__vite-browser-external-v7f2oYTb.js";import{u as L,S as E,f as S,b as q}from"./browser-BwFqrqKh.js";import{f as ee}from"./url-CCw57Dwn.js";class F extends Error{constructor(e,t){super(e),Error.captureStackTrace(this,this.constructor),this.type=t}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}}class R extends F{constructor(e,t,o){super(e,t),o&&(this.code=this.errno=o.code,this.erroredSysCall=o.syscall)}}const N=Symbol.toStringTag,Y=r=>typeof r=="object"&&typeof r.append=="function"&&typeof r.delete=="function"&&typeof r.get=="function"&&typeof r.getAll=="function"&&typeof r.has=="function"&&typeof r.set=="function"&&typeof r.sort=="function"&&r[N]==="URLSearchParams",I=r=>r&&typeof r=="object"&&typeof r.arrayBuffer=="function"&&typeof r.type=="string"&&typeof r.stream=="function"&&typeof r.constructor=="function"&&/^(Blob|File)$/.test(r[N]),re=r=>typeof r=="object"&&(r[N]==="AbortSignal"||r[N]==="EventTarget"),te=(r,e)=>{const t=new URL(e).hostname,o=new URL(r).hostname;return t===o||t.endsWith(`.${o}`)},ne=(r,e)=>{const t=new URL(e).protocol,o=new URL(r).protocol;return t===o},oe=L.promisify(E.pipeline),g=Symbol("Body internals");class k{constructor(e,{size:t=0}={}){let o=null;e===null?e=null:Y(e)?e=d.from(e.toString()):I(e)||d.isBuffer(e)||(L.types.isAnyArrayBuffer(e)?e=d.from(e):ArrayBuffer.isView(e)?e=d.from(e.buffer,e.byteOffset,e.byteLength):e instanceof E||(e=d.from(String(e))));let n=e;d.isBuffer(e)?n=E.Readable.from(e):I(e)&&(n=E.Readable.from(e.stream())),this[g]={body:e,stream:n,boundary:o,disturbed:!1,error:null},this.size=t,e instanceof E&&e.on("error",s=>{const a=s instanceof F?s:new R(`Invalid response body while trying to fetch ${this.url}: ${s.message}`,"system",s);this[g].error=a})}get body(){return this[g].stream}get bodyUsed(){return this[g].disturbed}async arrayBuffer(){const{buffer:e,byteOffset:t,byteLength:o}=await M(this);return e.slice(t,t+o)}async blob(){const e=this.headers&&this.headers.get("content-type")||this[g].body&&this[g].body.type||"",t=await this.arrayBuffer();return new Blob([t],{type:e})}async json(){const e=await this.text();return JSON.parse(e)}async text(){const e=await M(this);return new TextDecoder().decode(e)}buffer(){return M(this)}}k.prototype.buffer=L.deprecate(k.prototype.buffer,"Please use 'response.arrayBuffer()' instead of 'response.buffer()'","node-fetch#buffer");Object.defineProperties(k.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0},data:{get:L.deprecate(()=>{},"data doesn't exist, use json(), text(), arrayBuffer(), or body instead","https://github.com/node-fetch/node-fetch/issues/1000 (response)")}});async function M(r){if(r[g].disturbed)throw new TypeError(`body used already for: ${r.url}`);if(r[g].disturbed=!0,r[g].error)throw r[g].error;const{body:e}=r;if(e===null)return d.alloc(0);if(!(e instanceof E))return d.alloc(0);const t=[];let o=0;try{for await(const n of e){if(r.size>0&&o+n.length>r.size){const s=new R(`content size at ${r.url} over limit: ${r.size}`,"max-size");throw e.destroy(s),s}o+=n.length,t.push(n)}}catch(n){throw n instanceof F?n:new R(`Invalid response body while trying to fetch ${r.url}: ${n.message}`,"system",n)}if(e.readableEnded===!0||e._readableState.ended===!0)try{return t.every(n=>typeof n=="string")?d.from(t.join("")):d.concat(t,o)}catch(n){throw new R(`Could not create Buffer from response body for ${r.url}: ${n.message}`,"system",n)}else throw new R(`Premature close of server response while trying to fetch ${r.url}`)}const D=(r,e)=>{let t,o,{body:n}=r[g];if(r.bodyUsed)throw new Error("cannot clone body after it is used");return n instanceof E&&typeof n.getBoundary!="function"&&(t=new S.PassThrough({highWaterMark:e}),o=new S.PassThrough({highWaterMark:e}),n.pipe(t),n.pipe(o),r[g].stream=t,n=o),n},se=L.deprecate(r=>r.getBoundary(),"form-data doesn't follow the spec and requires special treatment. Use alternative package","https://github.com/node-fetch/node-fetch/issues/1167"),Z=(r,e)=>r===null?null:typeof r=="string"?"text/plain;charset=UTF-8":Y(r)?"application/x-www-form-urlencoded;charset=UTF-8":I(r)?r.type||null:d.isBuffer(r)||L.types.isAnyArrayBuffer(r)||ArrayBuffer.isView(r)?null:r&&typeof r.getBoundary=="function"?`multipart/form-data;boundary=${se(r)}`:r instanceof E?null:"text/plain;charset=UTF-8",ie=r=>{const{body:e}=r[g];return e===null?0:I(e)?e.size:d.isBuffer(e)?e.length:e&&typeof e.getLengthSync=="function"&&e.hasKnownLength&&e.hasKnownLength()?e.getLengthSync():null},ae=async(r,{body:e})=>{e===null?r.end():await oe(e,r)},H=typeof m.validateHeaderName=="function"?m.validateHeaderName:r=>{if(!/^[\^`\-\w!#$%&'*+.|~]+$/.test(r)){const e=new TypeError(`Header name must be a valid HTTP token [${r}]`);throw Object.defineProperty(e,"code",{value:"ERR_INVALID_HTTP_TOKEN"}),e}},W=typeof m.validateHeaderValue=="function"?m.validateHeaderValue:(r,e)=>{if(/[^\t\u0020-\u007E\u0080-\u00FF]/.test(e)){const t=new TypeError(`Invalid character in header content ["${r}"]`);throw Object.defineProperty(t,"code",{value:"ERR_INVALID_CHAR"}),t}};class v extends URLSearchParams{constructor(e){let t=[];if(e instanceof v){const o=e.raw();for(const[n,s]of Object.entries(o))t.push(...s.map(a=>[n,a]))}else if(e!=null)if(typeof e=="object"&&!L.types.isBoxedPrimitive(e)){const o=e[Symbol.iterator];if(o==null)t.push(...Object.entries(e));else{if(typeof o!="function")throw new TypeError("Header pairs must be iterable");t=[...e].map(n=>{if(typeof n!="object"||L.types.isBoxedPrimitive(n))throw new TypeError("Each header pair must be an iterable object");return[...n]}).map(n=>{if(n.length!==2)throw new TypeError("Each header pair must be a name/value tuple");return[...n]})}}else throw new TypeError("Failed to construct 'Headers': The provided value is not of type '(sequence<sequence<ByteString>> or record<ByteString, ByteString>)");return t=t.length>0?t.map(([o,n])=>(H(o),W(o,String(n)),[String(o).toLowerCase(),String(n)])):void 0,super(t),new Proxy(this,{get(o,n,s){switch(n){case"append":case"set":return(a,u)=>(H(a),W(a,String(u)),URLSearchParams.prototype[n].call(o,String(a).toLowerCase(),String(u)));case"delete":case"has":case"getAll":return a=>(H(a),URLSearchParams.prototype[n].call(o,String(a).toLowerCase()));case"keys":return()=>(o.sort(),new Set(URLSearchParams.prototype.keys.call(o)).keys());default:return Reflect.get(o,n,s)}}})}get[Symbol.toStringTag](){return this.constructor.name}toString(){return Object.prototype.toString.call(this)}get(e){const t=this.getAll(e);if(t.length===0)return null;let o=t.join(", ");return/^content-encoding$/i.test(e)&&(o=o.toLowerCase()),o}forEach(e,t=void 0){for(const o of this.keys())Reflect.apply(e,t,[this.get(o),o,this])}*values(){for(const e of this.keys())yield this.get(e)}*entries(){for(const e of this.keys())yield[e,this.get(e)]}[Symbol.iterator](){return this.entries()}raw(){return[...this.keys()].reduce((e,t)=>(e[t]=this.getAll(t),e),{})}[Symbol.for("nodejs.util.inspect.custom")](){return[...this.keys()].reduce((e,t)=>{const o=this.getAll(t);return t==="host"?e[t]=o[0]:e[t]=o.length>1?o:o[0],e},{})}}Object.defineProperties(v.prototype,["get","entries","forEach","values"].reduce((r,e)=>(r[e]={enumerable:!0},r),{}));function ce(r=[]){return new v(r.reduce((e,t,o,n)=>(o%2===0&&e.push(n.slice(o,o+2)),e),[]).filter(([e,t])=>{try{return H(e),W(e,String(t)),!0}catch{return!1}}))}const ue=new Set([301,302,303,307,308]),_=r=>ue.has(r),b=Symbol("Response internals");class w extends k{constructor(e=null,t={}){super(e,t);const o=t.status!=null?t.status:200,n=new v(t.headers);if(e!==null&&!n.has("Content-Type")){const s=Z(e);s&&n.append("Content-Type",s)}this[b]={type:"default",url:t.url,status:o,statusText:t.statusText||"",headers:n,counter:t.counter,highWaterMark:t.highWaterMark}}get type(){return this[b].type}get url(){return this[b].url||""}get status(){return this[b].status}get ok(){return this[b].status>=200&&this[b].status<300}get redirected(){return this[b].counter>0}get statusText(){return this[b].statusText}get headers(){return this[b].headers}get highWaterMark(){return this[b].highWaterMark}clone(){return new w(D(this,this.highWaterMark),{type:this.type,url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected,size:this.size,highWaterMark:this.highWaterMark})}static redirect(e,t=302){if(!_(t))throw new RangeError('Failed to execute "redirect" on "response": Invalid status code');return new w(null,{headers:{location:new URL(e).toString()},status:t})}static error(){const e=new w(null,{status:0,statusText:""});return e[b].type="error",e}static json(e=void 0,t={}){const o=JSON.stringify(e);if(o===void 0)throw new TypeError("data is not JSON serializable");const n=new v(t&&t.headers);return n.has("content-type")||n.set("content-type","application/json"),new w(o,{...t,headers:n})}get[Symbol.toStringTag](){return"Response"}}Object.defineProperties(w.prototype,{type:{enumerable:!0},url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}});const le=r=>{if(r.search)return r.search;const e=r.href.length-1,t=r.hash||(r.href[e]==="#"?"#":"");return r.href[e-t.length]==="?"?"?":""};function J(r,e=!1){return r==null||(r=new URL(r),/^(about|blob|data):$/.test(r.protocol))?"no-referrer":(r.username="",r.password="",r.hash="",e&&(r.pathname="",r.search=""),r)}const Q=new Set(["","no-referrer","no-referrer-when-downgrade","same-origin","origin","strict-origin","origin-when-cross-origin","strict-origin-when-cross-origin","unsafe-url"]),fe="strict-origin-when-cross-origin";function he(r){if(!Q.has(r))throw new TypeError(`Invalid referrerPolicy: ${r}`);return r}function de(r){if(/^(http|ws)s:$/.test(r.protocol))return!0;const e=r.host.replace(/(^\[)|(]$)/g,""),t=q.isIP(e);return t===4&&/^127\./.test(e)||t===6&&/^(((0+:){7})|(::(0+:){0,6}))0*1$/.test(e)?!0:r.host==="localhost"||r.host.endsWith(".localhost")?!1:r.protocol==="file:"}function x(r){return/^about:(blank|srcdoc)$/.test(r)||r.protocol==="data:"||/^(blob|filesystem):$/.test(r.protocol)?!0:de(r)}function pe(r,{referrerURLCallback:e,referrerOriginCallback:t}={}){if(r.referrer==="no-referrer"||r.referrerPolicy==="")return null;const o=r.referrerPolicy;if(r.referrer==="about:client")return"no-referrer";const n=r.referrer;let s=J(n),a=J(n,!0);s.toString().length>4096&&(s=a),e&&(s=e(s)),t&&(a=t(a));const u=new URL(r.url);switch(o){case"no-referrer":return"no-referrer";case"origin":return a;case"unsafe-url":return s;case"strict-origin":return x(s)&&!x(u)?"no-referrer":a.toString();case"strict-origin-when-cross-origin":return s.origin===u.origin?s:x(s)&&!x(u)?"no-referrer":a;case"same-origin":return s.origin===u.origin?s:"no-referrer";case"origin-when-cross-origin":return s.origin===u.origin?s:a;case"no-referrer-when-downgrade":return x(s)&&!x(u)?"no-referrer":s;default:throw new TypeError(`Invalid referrerPolicy: ${o}`)}}function ge(r){const e=(r.get("referrer-policy")||"").split(/[,\s]+/);let t="";for(const o of e)o&&Q.has(o)&&(t=o);return t}const f=Symbol("Request internals"),C=r=>typeof r=="object"&&typeof r[f]=="object",ye=L.deprecate(()=>{},".data is not a valid RequestInit property, use .body instead","https://github.com/node-fetch/node-fetch/issues/1000 (request)");class z extends k{constructor(e,t={}){let o;if(C(e)?o=new URL(e.url):(o=new URL(e),e={}),o.username!==""||o.password!=="")throw new TypeError(`${o} is an url with embedded credentials.`);let n=t.method||e.method||"GET";if(/^(delete|get|head|options|post|put)$/i.test(n)&&(n=n.toUpperCase()),!C(t)&&"data"in t&&ye(),(t.body!=null||C(e)&&e.body!==null)&&(n==="GET"||n==="HEAD"))throw new TypeError("Request with GET/HEAD method cannot have body");const s=t.body?t.body:C(e)&&e.body!==null?D(e):null;super(s,{size:t.size||e.size||0});const a=new v(t.headers||e.headers||{});if(s!==null&&!a.has("Content-Type")){const i=Z(s);i&&a.set("Content-Type",i)}let u=C(e)?e.signal:null;if("signal"in t&&(u=t.signal),u!=null&&!re(u))throw new TypeError("Expected signal to be an instanceof AbortSignal or EventTarget");let l=t.referrer==null?e.referrer:t.referrer;if(l==="")l="no-referrer";else if(l){const i=new URL(l);l=/^about:(\/\/)?client$/.test(i)?"client":i}else l=void 0;this[f]={method:n,redirect:t.redirect||e.redirect||"follow",headers:a,parsedURL:o,signal:u,referrer:l},this.follow=t.follow===void 0?e.follow===void 0?20:e.follow:t.follow,this.compress=t.compress===void 0?e.compress===void 0?!0:e.compress:t.compress,this.counter=t.counter||e.counter||0,this.agent=t.agent||e.agent,this.highWaterMark=t.highWaterMark||e.highWaterMark||16384,this.insecureHTTPParser=t.insecureHTTPParser||e.insecureHTTPParser||!1,this.referrerPolicy=t.referrerPolicy||e.referrerPolicy||""}get method(){return this[f].method}get url(){return ee(this[f].parsedURL)}get headers(){return this[f].headers}get redirect(){return this[f].redirect}get signal(){return this[f].signal}get referrer(){if(this[f].referrer==="no-referrer")return"";if(this[f].referrer==="client")return"about:client";if(this[f].referrer)return this[f].referrer.toString()}get referrerPolicy(){return this[f].referrerPolicy}set referrerPolicy(e){this[f].referrerPolicy=he(e)}clone(){return new z(this)}get[Symbol.toStringTag](){return"Request"}}Object.defineProperties(z.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0},referrer:{enumerable:!0},referrerPolicy:{enumerable:!0}});const me=r=>{const{parsedURL:e}=r[f],t=new v(r[f].headers);t.has("Accept")||t.set("Accept","*/*");let o=null;if(r.body===null&&/^(post|put)$/i.test(r.method)&&(o="0"),r.body!==null){const u=ie(r);typeof u=="number"&&!Number.isNaN(u)&&(o=String(u))}o&&t.set("Content-Length",o),r.referrerPolicy===""&&(r.referrerPolicy=fe),r.referrer&&r.referrer!=="no-referrer"?r[f].referrer=pe(r):r[f].referrer="no-referrer",r[f].referrer instanceof URL&&t.set("Referer",r.referrer),t.has("User-Agent")||t.set("User-Agent","node-fetch"),r.compress&&!t.has("Accept-Encoding")&&t.set("Accept-Encoding","gzip, deflate, br");let{agent:n}=r;typeof n=="function"&&(n=n(e)),!t.has("Connection")&&!n&&t.set("Connection","close");const s=le(e),a={path:e.pathname+s,method:r.method,headers:t[Symbol.for("nodejs.util.inspect.custom")](),insecureHTTPParser:r.insecureHTTPParser,agent:n};return{parsedURL:e,options:a}};class we extends F{constructor(e,t="aborted"){super(e,t)}}const be=new Set(["data:","http:","https:"]);async function Te(r,e){return new Promise((t,o)=>{const n=new z(r,e),{parsedURL:s,options:a}=me(n);if(!be.has(s.protocol))throw new TypeError(`node-fetch cannot load ${r}. URL scheme "${s.protocol.replace(/:$/,"")}" is not supported.`);const u=(s.protocol==="https:"?m:m).request,{signal:l}=n;let i=null;const V=()=>{const c=new we("The operation was aborted.");o(c),n.body&&n.body instanceof E.Readable&&n.body.destroy(c),!(!i||!i.body)&&i.body.emit("error",c)};if(l&&l.aborted){V();return}const O=()=>{V(),A()},$=u(s.toString(),a);l&&l.addEventListener("abort",O);const A=()=>{$.abort(),l&&l.removeEventListener("abort",O)};$.on("error",c=>{o(new R(`request to ${n.url} failed, reason: ${c.message}`,"system",c)),A()}),Se($,c=>{i&&i.body&&i.body.destroy(c)}),K.version<"v14"&&$.on("socket",c=>{let B;c.prependListener("end",()=>{B=c._eventsCount}),c.prependListener("close",h=>{if(i&&B<c._eventsCount&&!h){const P=new Error("Premature close");P.code="ERR_STREAM_PREMATURE_CLOSE",i.body.emit("error",P)}})}),$.on("response",c=>{$.setTimeout(0);const B=ce(c.rawHeaders);if(_(c.statusCode)){const p=B.get("Location");let T=null;try{T=p===null?null:new URL(p,n.url)}catch{if(n.redirect!=="manual"){o(new R(`uri requested responds with an invalid redirect URL: ${p}`,"invalid-redirect")),A();return}}switch(n.redirect){case"error":o(new R(`uri requested responds with a redirect, redirect mode is set to error: ${n.url}`,"no-redirect")),A();return;case"manual":break;case"follow":{if(T===null)break;if(n.counter>=n.follow){o(new R(`maximum redirect reached at: ${n.url}`,"max-redirect")),A();return}const y={headers:new v(n.headers),follow:n.follow,counter:n.counter+1,agent:n.agent,compress:n.compress,method:n.method,body:D(n),signal:n.signal,size:n.size,referrer:n.referrer,referrerPolicy:n.referrerPolicy};if(!te(n.url,T)||!ne(n.url,T))for(const j of["authorization","www-authenticate","cookie","cookie2"])y.headers.delete(j);if(c.statusCode!==303&&n.body&&e.body instanceof E.Readable){o(new R("Cannot follow redirect with body being a readable stream","unsupported-redirect")),A();return}(c.statusCode===303||(c.statusCode===301||c.statusCode===302)&&n.method==="POST")&&(y.method="GET",y.body=void 0,y.headers.delete("content-length"));const G=ge(B);G&&(y.referrerPolicy=G),t(Te(new z(T,y))),A();return}default:return o(new TypeError(`Redirect option '${n.redirect}' is not a valid value of RequestRedirect`))}}l&&c.once("end",()=>{l.removeEventListener("abort",O)});let h=S.pipeline(c,new S.PassThrough,p=>{p&&o(p)});K.version<"v12.10"&&c.on("aborted",O);const P={url:n.url,status:c.statusCode,statusText:c.statusMessage,headers:B,size:n.size,counter:n.counter,highWaterMark:n.highWaterMark},U=B.get("Content-Encoding");if(!n.compress||n.method==="HEAD"||U===null||c.statusCode===204||c.statusCode===304){i=new w(h,P),t(i);return}const X={flush:m.Z_SYNC_FLUSH,finishFlush:m.Z_SYNC_FLUSH};if(U==="gzip"||U==="x-gzip"){h=S.pipeline(h,m.createGunzip(X),p=>{p&&o(p)}),i=new w(h,P),t(i);return}if(U==="deflate"||U==="x-deflate"){const p=S.pipeline(c,new S.PassThrough,T=>{T&&o(T)});p.once("data",T=>{(T[0]&15)===8?h=S.pipeline(h,m.createInflate(),y=>{y&&o(y)}):h=S.pipeline(h,m.createInflateRaw(),y=>{y&&o(y)}),i=new w(h,P),t(i)}),p.once("end",()=>{i||(i=new w(h,P),t(i))});return}if(U==="br"){h=S.pipeline(h,m.createBrotliDecompress(),p=>{p&&o(p)}),i=new w(h,P),t(i);return}i=new w(h,P),t(i)}),ae($,n).catch(o)})}function Se(r,e){const t=d.from(`0\r
\r
`);let o=!1,n=!1,s;r.on("response",a=>{const{headers:u}=a;o=u["transfer-encoding"]==="chunked"&&!u["content-length"]}),r.on("socket",a=>{const u=()=>{if(o&&!n){const i=new Error("Premature close");i.code="ERR_STREAM_PREMATURE_CLOSE",e(i)}},l=i=>{n=d.compare(i.slice(-5),t)===0,!n&&s&&(n=d.compare(s.slice(-3),t.slice(0,3))===0&&d.compare(i.slice(-2),t.slice(3))===0),s=i};a.prependListener("close",u),a.on("data",l),r.on("close",()=>{a.removeListener("close",u),a.removeListener("data",l)})})}export{we as AbortError,R as FetchError,v as Headers,z as Request,w as Response,Te as default,_ as isRedirect};
