import{aY as p,aW as m,aX as w}from"./index-DacOZnWA.js";import{b as P,r as O}from"./browser-BwFqrqKh.js";import{r as D,b as j,s as H}from"./index-BJj6QqBT.js";function $(o,e){for(var r=0;r<e.length;r++){const t=e[r];if(typeof t!="string"&&!Array.isArray(t)){for(const u in t)if(u!=="default"&&!(u in o)){const n=Object.getOwnPropertyDescriptor(t,u);n&&Object.defineProperty(o,u,n.get?n:{enumerable:!0,get:()=>t[u]})}}}return Object.freeze(Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}))}var b={},v={};Object.defineProperty(v,"__esModule",{value:!0});function S(o,e,{signal:r}={}){return new Promise((t,u)=>{function n(){r==null||r.removeEventListener("abort",n),o.removeListener(e,a),o.removeListener("error",i)}function a(...s){n(),t(s)}function i(s){n(),u(s)}r==null||r.addEventListener("abort",n),o.on(e,a),o.on("error",i)})}v.default=S;var A=p&&p.__awaiter||function(o,e,r,t){function u(n){return n instanceof r?n:new r(function(a){a(n)})}return new(r||(r=Promise))(function(n,a){function i(c){try{l(t.next(c))}catch(h){a(h)}}function s(c){try{l(t.throw(c))}catch(h){a(h)}}function l(c){c.done?n(c.value):u(c.value).then(i,s)}l((t=t.apply(o,e||[])).next())})},d=p&&p.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(b,"__esModule",{value:!0});const E=d(P),T=d(O),_=d(D),k=d(j),M=d(v),C=H,f=(0,k.default)("http-proxy-agent");function L(o){return typeof o=="string"?/^https:?$/i.test(o):!1}class z extends C.Agent{constructor(e){let r;if(typeof e=="string"?r=_.default.parse(e):r=e,!r)throw new Error("an HTTP(S) proxy server `host` and `port` must be specified!");f("Creating new HttpProxyAgent instance: %o",r),super(r);const t=Object.assign({},r);this.secureProxy=r.secureProxy||L(t.protocol),t.host=t.hostname||t.host,typeof t.port=="string"&&(t.port=parseInt(t.port,10)),!t.port&&t.host&&(t.port=this.secureProxy?443:80),t.host&&t.path&&(delete t.path,delete t.pathname),this.proxy=t}callback(e,r){return A(this,void 0,void 0,function*(){const{proxy:t,secureProxy:u}=this,n=_.default.parse(e.path);n.protocol||(n.protocol="http:"),n.hostname||(n.hostname=r.hostname||r.host||null),n.port==null&&typeof r.port&&(n.port=String(r.port)),n.port==="80"&&(n.port=""),e.path=_.default.format(n),t.auth&&e.setHeader("Proxy-Authorization",`Basic ${m.from(t.auth).toString("base64")}`);let a;if(u?(f("Creating `tls.Socket`: %o",t),a=T.default.connect(t)):(f("Creating `net.Socket`: %o",t),a=E.default.connect(t)),e._header){let i,s;f("Regenerating stored HTTP header string for request"),e._header=null,e._implicitHeader(),e.output&&e.output.length>0?(f("Patching connection write() output buffer with updated header"),i=e.output[0],s=i.indexOf(`\r
\r
`)+4,e.output[0]=e._header+i.substring(s),f("Output buffer: %o",e.output)):e.outputData&&e.outputData.length>0&&(f("Patching connection write() output buffer with updated header"),i=e.outputData[0].data,s=i.indexOf(`\r
\r
`)+4,e.outputData[0].data=e._header+i.substring(s),f("Output buffer: %o",e.outputData[0].data))}return yield(0,M.default)(a,"connect"),a})}}b.default=z;var B=p&&p.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};const y=B(b);function g(o){return new y.default(o)}(function(o){o.HttpProxyAgent=y.default,o.prototype=y.default.prototype})(g||(g={}));var x=g;const F=w(x),R=$({__proto__:null,default:F},[x]);export{R as i};
